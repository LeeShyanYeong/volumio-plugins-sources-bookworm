{"version":3,"file":"Util.js","sourceRoot":"","sources":["../../src/lib/Util.ts"],"names":[],"mappings":"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","sourcesContent":["// eslint-disable-next-line @typescript-eslint/ban-ts-comment\n// @ts-ignore\nimport libQ from 'kew';\n\nimport os from 'os';\nimport {type ServerCredentials} from './types/Server';\nimport type Server from './types/Server';\nimport { type BasicPlayerStartupParams } from './types/Player';\nimport { SQUEEZELITE_LOG_FILE } from './System';\n\nconst DSD_FORMAT_TO_SQUEEZELITE_OPT: Record<string, string> = {\n  'dop': 'dop',\n  'DSD_U8': 'u8',\n  'DSD_U16_LE': 'u16le',\n  'DSD_U16_BE': 'u16be',\n  'DSD_U32_LE': 'u32le',\n  'DSD_U32_BE': 'u32be'\n};\n\nexport interface ServerConnectParams {\n  host?: string;\n  port?: string;\n  username?: string;\n  password?: string;\n}\n\nexport interface NetworkInterfaces {\n  [ifName: string]: {\n    address: string;\n    mac: string;\n  }[];\n}\n\nexport function getNetworkInterfaces() {\n  const result: NetworkInterfaces = {};\n  for (const [ ifName, addresses ] of Object.entries(os.networkInterfaces())) {\n    const filteredAddresses = addresses?.filter((ni) => ni.family === 'IPv4' && !ni.internal) || [];\n    if (filteredAddresses.length > 0) {\n      result[ifName] = filteredAddresses.map((addr) => ({\n        address: addr.address,\n        mac: addr.mac\n      }));\n    }\n  }\n\n  return result;\n}\n\nexport function encodeBase64(str: string) {\n  return Buffer.from(str).toString('base64');\n}\n\nexport function getServerConnectParams(server: Server, serverCredentials: ServerCredentials | undefined, connectType: 'rpc' | 'cli') {\n  const params: ServerConnectParams = {\n    host: connectType === 'rpc' ? `http://${server.ip}` : server.ip,\n    port: connectType === 'rpc' ? server.jsonPort : server.cliPort || '9090'\n  };\n  if (serverCredentials && serverCredentials[server.name]) {\n    const { username, password } = serverCredentials[server.name];\n    params.username = username;\n    params.password = password;\n  }\n  return params;\n}\n\nexport function jsPromiseToKew<T>(promise: Promise<T>): any {\n  const defer = libQ.defer();\n\n  promise.then((result) => {\n    defer.resolve(result);\n  })\n    .catch((error: unknown) => {\n      defer.reject(error);\n    });\n\n  return defer.promise;\n}\n\nexport function kewToJSPromise(promise: any): Promise<any> {\n  // Guard against a JS promise from being passed to this function.\n  if (typeof promise.catch === 'function' && typeof promise.fail === 'undefined') {\n    // JS promise - return as is\n    return promise;\n  }\n  return new Promise((resolve, reject) => {\n    promise.then((result: any) => {\n      resolve(result);\n    })\n      .fail((error: Error) => {\n        reject(error);\n      });\n  });\n}\n\nexport class PlaybackTimer {\n  #seek: number;\n  #timer: NodeJS.Timeout | null;\n\n  constructor() {\n    this.#seek = 0;\n    this.#timer = null;\n  }\n\n  start(seek = 0) {\n    this.stop();\n    this.#seek = seek;\n    this.#timer = setInterval(() => {\n      this.#seek += 1000;\n    }, 1000);\n  }\n\n  stop() {\n    if (this.#timer) {\n      clearInterval(this.#timer);\n      this.#timer = null;\n    }\n    this.#seek = 0;\n  }\n\n  getSeek() {\n    return this.#seek;\n  }\n}\n\nexport function basicPlayerStartupParamsToSqueezeliteOpts(params: BasicPlayerStartupParams) {\n  // Returns:\n  // -o squeezelite -C 1 -n {playerName} -D 3:{dsdFormat} -V {mixer} -f ${logFile}\n  const parts = [\n    '-o squeezelite',\n    '-C 1'\n  ];\n  if (params.playerName) {\n    parts.push(`-n \"${params.playerName}\"`);\n  }\n  if (params.dsdFormat) {\n    const dsdFormat = DSD_FORMAT_TO_SQUEEZELITE_OPT[params.dsdFormat];\n    if (dsdFormat) {\n      parts.push(`-D 3:${dsdFormat}`);\n    }\n  }\n  if (params.mixer) {\n    parts.push(`-V \"${params.mixer}\"`);\n  }\n  parts.push(`-f ${SQUEEZELITE_LOG_FILE}`);\n\n  return parts.join(' ');\n}\n"]}